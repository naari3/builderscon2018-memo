# a

## rom

### program rom
### char rom

graphicの情報が入ってる

## iNESフォーマット

.nesは２つのファイルを結合してるだけ

## js

wasmでromをやりとりするのは大変
最初にjsでfetchする
arraybufferで領域確保、mallocしてwasmで渡す

## RAMの実装

## CPU

6502

### レジスタ

6個
AXY

### CPUバス実装

CpuBusモジュールでアクセス、テストしやすくするため

### 割り込み

リセットなど

### NMI

No mascable interrupt

## PPU

GPUのようなもの
テーブルがたくさん

### ネームテーブル

背景タイルが大量に詰まっている

### 属性テーブル

色の成約はとても厳しい、色情報は2bit
VRAMは2kbしかない

### パエrっとテーブル

同時に使用できるのは背景13色
スプライトパレットも

#### 色と値の対応

NTSC信号で表現
RGMではない
輝度と色度で表現

### PPUレジスタ

CPUがPPUを経由して画面に描画する

### 描画手順

1. ネームテーブルからリード、スプライト番号取得
2. スプライト情報を読む
3. アトリビュート取得
4. パレットカラー取得
5. スプライトにパレットを割り当て、描画

## どう表示するか？

mergeIntoを使用し、公開するJSの関数を詰めて ピクセルデータを公開した関数の引数にして呼び出す

### データ表示

Vblank

60fpsでやるために requestAnimationFrame使いたい
rustで使う

## スクロール

画面が2つつながっていて、その２つの画面のどの部分を切り取るか決める
ラスタスクロール

## スプライト

スプライトRAM256byte
横反転 縦反転 ステータス

スプライト0ビット
- こいつの後からスクロールさせるようにすることで固定ヘッダを実現

大きなボスは背景として、足場をスプライトとして左に流す

### DMA

DMAを使って転送
